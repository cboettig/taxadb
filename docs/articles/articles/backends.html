<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Backends for taxadb • taxadb</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Backends for taxadb">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">taxadb</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/articles/backends.html">Backends for taxadb</a>
    </li>
    <li>
      <a href="../../articles/articles/data-sources.html">Name Providers and schema used in taxadb</a>
    </li>
    <li>
      <a href="../../articles/articles/intro.html">Tutorial for taxadb</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/cboettig/taxadb">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Backends for taxadb</h1>
                        <h4 class="author">Carl Boettiger, Kari Norman</h4>
            
            <h4 class="date">2019-10-29</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/cboettig/taxadb/blob/master/vignettes/articles/backends.Rmd"><code>vignettes/articles/backends.Rmd</code></a></small>
      <div class="hidden name"><code>backends.Rmd</code></div>

    </div>

    
    
<p><code>taxadb</code> is designed to work with a variety of different “backends” – software that works under the hood to store and retrieve the requested data. <code>taxadb</code> has an intelligent default method selector which will attempt to use the best method available on your system, which means you can use <code>taxadb</code> without having to worry about these details. However, to improve performance of <code>taxadb</code>, becoming familiar with these backends can yield significant improvements in performance.</p>
<div id="rsqlite" class="section level1">
<h1 class="hasAnchor">
<a href="#rsqlite" class="anchor"></a>RSQLite</h1>
<p><code>RSQLite</code> is the default database backend if no suggested backend is detected. <code>RSQLite</code> has no external software dependencies and will be autmatically installed with <code>taxadb</code> (it is a hard dependency as an imported rather than suggested package). The term <code>Lite</code> indicates that SQLite does not require the seperate “server” and “client” software model found on traditional databases such as MySQL, and SQLite is widely used in consumer software everywhere. RSQLite packages SQLite for R. It enables persistant local storage for R applications but will be slower than the alternatives. For certain operations it can be significantly slower.</p>
</div>
<div id="monetdblite-duckdb" class="section level1">
<h1 class="hasAnchor">
<a href="#monetdblite-duckdb" class="anchor"></a>MonetDBLite &amp; duckdb</h1>
<p><code>MonetDBLite</code> is a modern alternative to <code>RSQLite</code>. <code>MonetDBLite</code> is both more powerful than SQLite (in supporting a greater array of operations), and can run much faster. Filtering joins in particular can be much faster even than the in-memory operations of <code>dplyr</code>. Because filtering joins lie at the heart of many <code>taxadb</code> functions this can yield substantial improvements in performance. Unfortunately, the R interface, <code>MonetDBLite</code> was removed from CRAN in April 2019. The package can still be installed from GitHub by running <code><a href="https://rdrr.io/pkg/devtools/man/remote-reexports.html">devtools::install_github("hannesmuehleisen/MonetDBLite-R")</a></code>, though this requires the appropriate compilers. The developer plans to replace MonetDBLite with <code>duckdb</code>, (see <a href="https://github.com/cwida/duckdb" class="uri">https://github.com/cwida/duckdb</a>), but this is not yet feature complete and thus not yet fully compatible for <code>taxadb</code> use. Because installation is more difficult, <code>MonetDBLite</code> is not a required dependency, but will be used by default if <code>taxadb</code> detects an existing installation. <code>duckdb</code> support will be switched on as the first priority in the method waterfall.</p>
</div>
<div id="in-memory" class="section level1">
<h1 class="hasAnchor">
<a href="#in-memory" class="anchor"></a>in-memory</h1>
<p><code>taxadb</code> can also be set to use in-memory only, without a backend. (Note that this is distinct from using <code>RSQlite</code> or <code>MonetDBLite</code> with over <code>in-memory</code> mode, because it uses only native R <code>data.frame</code>s to store data). This will tend to be faster that <code>RSQLite</code> but slower than <code>MonetDBLite</code> or <code>duckdb</code>. In this mode, data will persist over a single session but not between sessions (since memory is cleared when the user quits out of R). Note that many taxonomic tables are quite large when uncompressed, and users with less than 8-16GB of free RAM may find their machine becomes slow or unresponsive in this mode.</p>
</div>
<div id="manual-control-of-the-backend-engine" class="section level1">
<h1 class="hasAnchor">
<a href="#manual-control-of-the-backend-engine" class="anchor"></a>Manual control of the backend engine</h1>
<p>Users can override the automatic preferences of <code>taxadb</code> by setting the environmental variable <code>TAXADB_DRIVER</code>. For example, running <code><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv(TAXADB_DRIVER="RSQLite")</a></code> will make <code>RSQLite</code> the default driver, even if <code>MonetDBLite</code> is installed.</p>
</div>
<div id="local-storage" class="section level1">
<h1 class="hasAnchor">
<a href="#local-storage" class="anchor"></a>Local storage</h1>
<p>The first time <code>taxadb</code> accesses a data source, it will download and store the full dataset from that provider. Users can trigger a download ahead of time by running <code><a href="../../reference/td_create.html">td_create()</a></code>, e.g. <code><a href="../../reference/td_create.html">td_create("fb")</a></code> will create a local copy of the FishBase taxonomy. If a user does not call <code><a href="../../reference/td_create.html">td_create()</a></code> first, <code>taxadb</code> simply downloads the data the first time that provider is queried – e.g. <code><a href="../../reference/by_name.html">by_name("Homo sapiens", "gibf")</a></code> will first download and install GBIF if that has not been done already. These download and install operations may be slow depending on your internet connection, but need be performed only once. Downloaded data is stored on your local harddisk and will persist between R sessions. The default location depends on the default set by your operating system (see the <code>rappdirs</code> package). Users can configure this location by setting the environmental variable <code>TAXADB_HOME</code>. For example, all unit tests in the package use temporary storage by setting <code><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv(TAXADB_HOME=tempdir())</a></code>, which is cleared out after the R session ends.</p>
<p>A user can install all available name providers up front with <code><a href="../../reference/td_create.html">td_create("all")</a></code>. An overview of the available scientific name providers is found in the providers vignette.</p>
</div>
<div id="other-backends" class="section level1">
<h1 class="hasAnchor">
<a href="#other-backends" class="anchor"></a>Other backends</h1>
<p><code>taxadb</code> will work just as well with any <code>DBI</code>-compatible database backend (Postgres, MariaDB, etc). All <code>taxadb</code> functions take an argument <code>taxadb_db</code>, which is just a <code>DBI</code> connection used by <code>dplyr</code>. For example, we can create an in-memory RSQLite connection and use that to store data for a single session:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">con &lt;-<span class="st"> </span>DBI<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/DBI/man/dbConnect.html">dbConnect</a></span>(RSQLite<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/RSQLite/man/SQLite.html">SQLite</a></span>(), <span class="st">":memory:"</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">taxadb<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/taxadb/man/get_ids.html">get_ids</a></span>(<span class="st">"Homo sapiens"</span>, <span class="dt">taxadb_db =</span> con)</a></code></pre></div>
<p>Users can also call the <code><a href="../../reference/td_connect.html">td_connect()</a></code> function to connect to <code>taxadb</code>’s default databases. Running <code><a href="../../reference/td_connect.html">td_connect()</a></code> with no arguments will return the current default connection. This is a convenient way to confirm that your system is using the database engine you intended it to use. You can also use that connection to interact directly with the <code>taxadb</code> databases (e.g. using <code>dplyr</code> or <code>DBI</code> functions). The helper function <code><a href="../../reference/taxa_tbl.html">taxa_tbl()</a></code> is a quick way to access a remote table, e.g. <code>itis &lt;- taxa_tbl("itis")</code> is equivalent to:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(taxadb)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="co">#&gt; Registered S3 method overwritten by 'R.oo':</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co">#&gt;   method        from       </span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co">#&gt;   throw.default R.methodsS3</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">con &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/td_connect.html">td_connect</a></span>()</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">itis &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/tbl.html">tbl</a></span>(con, <span class="st">"dwc_itis"</span>) <span class="co"># ITIS Darwin Core table</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">## is the same as:</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9">itis &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/taxa_tbl.html">taxa_tbl</a></span>(<span class="st">"itis"</span>)</a></code></pre></div>
<p>This is often more powerful than using <code>taxadb</code>’s built in functions. For example, how many ranks are recognized by ITIS vs Catalogue of Life, and how many taxonomic names are in each rank?</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">#&gt; Attaching package: 'dplyr'</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co">#&gt; The following objects are masked from 'package:stats':</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">#&gt;     filter, lag</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co">#&gt; The following objects are masked from 'package:base':</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="co">#&gt;     intersect, setdiff, setequal, union</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="kw"><a href="../../reference/taxa_tbl.html">taxa_tbl</a></span>(<span class="st">"itis"</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/tally.html">count</a></span>(taxonRank, <span class="dt">sort=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="co">#&gt; # Source:     lazy query [?? x 2]</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="co">#&gt; # Database:   MonetDBEmbeddedConnection</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="co">#&gt; # Ordered by: desc(n)</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="co">#&gt;    taxonRank       n</span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="co">#&gt;    &lt;chr&gt;       &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb3-16" data-line-number="16"><span class="co">#&gt;  1 species    600526</span></a>
<a class="sourceLine" id="cb3-17" data-line-number="17"><span class="co">#&gt;  2 subspecies  72116</span></a>
<a class="sourceLine" id="cb3-18" data-line-number="18"><span class="co">#&gt;  3 genus       71406</span></a>
<a class="sourceLine" id="cb3-19" data-line-number="19"><span class="co">#&gt;  4 variety     32460</span></a>
<a class="sourceLine" id="cb3-20" data-line-number="20"><span class="co">#&gt;  5 family      10087</span></a>
<a class="sourceLine" id="cb3-21" data-line-number="21"><span class="co">#&gt;  6 subfamily    3069</span></a>
<a class="sourceLine" id="cb3-22" data-line-number="22"><span class="co">#&gt;  7 subgenus     2812</span></a>
<a class="sourceLine" id="cb3-23" data-line-number="23"><span class="co">#&gt;  8 order        1879</span></a>
<a class="sourceLine" id="cb3-24" data-line-number="24"><span class="co">#&gt;  9 tribe        1859</span></a>
<a class="sourceLine" id="cb3-25" data-line-number="25"><span class="co">#&gt; 10 form         1123</span></a>
<a class="sourceLine" id="cb3-26" data-line-number="26"><span class="co">#&gt; # … with more rows</span></a></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#rsqlite">RSQLite</a></li>
      <li><a href="#monetdblite-duckdb">MonetDBLite &amp; duckdb</a></li>
      <li><a href="#in-memory">in-memory</a></li>
      <li><a href="#manual-control-of-the-backend-engine">Manual control of the backend engine</a></li>
      <li><a href="#local-storage">Local storage</a></li>
      <li><a href="#other-backends">Other backends</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Carl Boettiger, Kari Norman, Jorrit Poelen, Scott Chamberlain.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
