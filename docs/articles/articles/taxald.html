<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>taxadb overview • taxadb</title>
<link rel="shortcut icon" type="image/x-icon" href="../../favicon.ico">
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="taxadb overview">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">taxadb</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/articles/crosswalk.html">Crosswalking The Authorities</a>
    </li>
    <li>
      <a href="../../articles/articles/schema.html">Database schema for taxadb</a>
    </li>
    <li>
      <a href="../../articles/articles/taxald.html">taxadb overview</a>
    </li>
    <li>
      <a href="../../articles/intro.html">Quickstart for taxadb</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/cboettig/taxadb">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>taxadb overview</h1>
                        <h4 class="author">Carl Boettiger</h4>
            
            <h4 class="date">2018-12-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/cboettig/taxadb/blob/master/vignettes/articles/taxald.Rmd"><code>vignettes/articles/taxald.Rmd</code></a></small>
      <div class="hidden name"><code>taxald.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(taxadb)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">library</span>(tidyr)</a></code></pre></div>
<div id="introduction-the-problem-of-name-matching" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction-the-problem-of-name-matching" class="anchor"></a>Introduction: the problem of name matching</h1>
<p>We frequently want to combine different data sources using species names. Perhaps we have one table which gives us occurrance information for a given list of species, and another table that contains trait information for species, and maybe a third source that provides a phylogenetic tree. If our system of scientific species names was perfect, we could simply do a “table join” using species name as the joining <code>key</code>, and all would be well.</p>
<p>Unfortunately, as anyone who has attempted this kind of exercise over more than a handful of species has discovered, this often works for most but very rarely for all of the species names involved. There are several reasons this process runs into problems.</p>
<p><strong>Synonyms</strong>. One of the most common problems is the existence of synonyms: different names or different spellings of a given scientific name. While this could include definite miss-spellings, for there are many species for which authorities can differ in the preferred name – essentially, two or more different names correspond to the same species, and should be treated as such in our species join.</p>
<p>For instance, we consider the 233 primate species names used in the <code>geiger</code> package <code>primates</code> data. To avoid installing that dependency-heavy package, a copy of these names has been cached in <code>taxadb</code> and can be loaded as follows:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">ex &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"extdata"</span>, <span class="st">"primates.tsv.bz2"</span>, <span class="dt">package =</span> <span class="st">"taxadb"</span>, <span class="dt">mustWork =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">primates &lt;-<span class="st"> </span>readr<span class="op">::</span><span class="kw"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_tsv</a></span>(ex)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co">#&gt; Parsed with column specification:</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co">#&gt; cols(</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">#&gt;   species = col_character()</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#&gt; )</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7">primates</a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">#&gt; # A tibble: 233 x 1</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co">#&gt;    species                    </span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="co">#&gt;    &lt;chr&gt;                      </span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="co">#&gt;  1 Allenopithecus nigroviridis</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="co">#&gt;  2 Allocebus trichotis        </span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="co">#&gt;  3 Alouatta belzebul          </span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="co">#&gt;  4 Alouatta caraya            </span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="co">#&gt;  5 Alouatta coibensis         </span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16"><span class="co">#&gt;  6 Alouatta fusca             </span></a>
<a class="sourceLine" id="cb2-17" data-line-number="17"><span class="co">#&gt;  7 Alouatta palliata          </span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18"><span class="co">#&gt;  8 Alouatta pigra             </span></a>
<a class="sourceLine" id="cb2-19" data-line-number="19"><span class="co">#&gt;  9 Alouatta sara              </span></a>
<a class="sourceLine" id="cb2-20" data-line-number="20"><span class="co">#&gt; 10 Alouatta seniculus         </span></a>
<a class="sourceLine" id="cb2-21" data-line-number="21"><span class="co">#&gt; # ... with 223 more rows</span></a></code></pre></div>
<p>Our goal will be to associate each name with a definitive taxonomic ID of an existing naming authority. This will allow us to merge on IDs directly, rather than names. By mapping both recognized names and synonyms to the same corresponding taxonomic ID, we can be sure that we can join the relevant data correctly.</p>
<div id="setup" class="section level2">
<h2 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h2>
<p>To get started, we’ll install all the data sources available to <code>taxadb</code> into a local database. This may take a while, particularly over a slow internet connection, but it needs to be done only once. The downloaded size of all data is around 3 GB. Once this task completes, our subsequent operations should all be quite fast.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="../../reference/td_create.html">td_create</a></span>(<span class="dt">authorities =</span> <span class="st">"all"</span>)</a></code></pre></div>
</div>
<div id="resolving-names" class="section level2">
<h2 class="hasAnchor">
<a href="#resolving-names" class="anchor"></a>Resolving names</h2>
<p>Match a list of 233 species names against a naming authority:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">my_taxa &lt;-<span class="st"> </span>primates <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># 233 taxa</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">id =</span> <span class="kw"><a href="../../reference/get_ids.html">get_ids</a></span>(species, <span class="dt">format =</span> <span class="st">"prefix"</span>)) </a></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">my_taxa <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">is.na</span>(id))</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co">#&gt; # A tibble: 3 x 2</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co">#&gt;   species            id   </span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">#&gt;   &lt;chr&gt;              &lt;chr&gt;</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co">#&gt; 1 Aotus brumbacki    &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co">#&gt; 2 Aotus hershkovitzi &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co">#&gt; 3 Varecia variegata  &lt;NA&gt;</span></a></code></pre></div>
<p>Only 3 species are missing ids, so we have managed to resolve 230 of the 233 species. Not bad! Actually,two of these do appear in ITIS records, but map to no accepted name according to ITIS:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">unmatched &lt;-<span class="st"> </span>my_taxa <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">is.na</span>(id)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/pull.html">pull</a></span>(species) </a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="kw"><a href="../../reference/synonyms.html">synonyms</a></span>(unmatched)</a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co">#&gt; # A tibble: 3 x 6</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co">#&gt;   name             accepted_name   id         synonym_id rank   update_date</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="co">#&gt;   &lt;chr&gt;            &lt;chr&gt;           &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;  &lt;chr&gt;      </span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co">#&gt; 1 Aotus hershkovi… Aotus lemurinus ITIS:5729… ITIS:5729… speci… 2014-06-26 </span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="co">#&gt; 2 Aotus brumbacki  &lt;NA&gt;            &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;       </span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="co">#&gt; 3 Varecia variega… &lt;NA&gt;            &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;</span></a></code></pre></div>
<p>Under the hood, <code>get_ids</code> checks the names against synonyms known to the authority as well. If we only looke for direct matches, we would have faired far worse.</p>
<p>Mimicking <code>taxize</code> function of the same name <code>get_ids</code> is returning just a vector of <code>ids</code>, which is useful for operations such as <code>mutate</code> above. However, it is often convenient to return the full table of matched names. Here we can see that many of the names we have matched against are actually synonyms, and that <code>get_ids</code> has been able to resolve them into accepted ids.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="../../reference/ids.html">ids</a></span>(primates<span class="op">$</span>species)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co">#&gt; # A tibble: 233 x 6</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#&gt;    id         accepted_id  update_date name               rank   name_usage</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt;    &lt;chr&gt;      &lt;chr&gt;        &lt;chr&gt;       &lt;chr&gt;              &lt;chr&gt;  &lt;chr&gt;     </span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co">#&gt;  1 ITIS:5728… ITIS:944041  2014-06-26  Microcebus coquer… speci… synonym   </span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt;  2 ITIS:5728… ITIS:944072  2014-06-26  Hapalemur simus    speci… synonym   </span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt;  3 ITIS:5728… ITIS:944100  2014-06-26  Galago alleni      speci… synonym   </span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#&gt;  4 ITIS:5729… ITIS:1025177 2017-03-30  Galagoides zanzib… speci… synonym   </span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co">#&gt;  5 ITIS:5729… ITIS:945103  2014-06-26  Tarsius bancanus   speci… synonym   </span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="co">#&gt;  6 ITIS:5729… ITIS:944117  2014-06-26  Tarsius dianae     speci… synonym   </span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="co">#&gt;  7 ITIS:5729… ITIS:944115  2014-06-26  Tarsius spectrum   speci… synonym   </span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="co">#&gt;  8 ITIS:5729… ITIS:945107  2014-06-26  Tarsius syrichta   speci… synonym   </span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="co">#&gt;  9 ITIS:5729… ITIS:944125  2014-06-26  Callithrix argent… speci… synonym   </span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="co">#&gt; 10 ITIS:5729… ITIS:944138  2014-06-26  Callithrix humera… speci… synonym   </span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="co">#&gt; # ... with 223 more rows</span></a></code></pre></div>
<p>Note that <code>name</code> is the name we provided (species names in this case, but it they do not have to be). Because <code>synonyms-check</code> is <code>TRUE</code> by default, we get a list of accepted names recognized (by ITIS in this case, our default authority).</p>
<p>We aren’t stuck with ITIS though, we can work with other naming authorities as well:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">my_taxa &lt;-<span class="st"> </span>primates <span class="op">%&gt;%</span><span class="st">  </span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">itis =</span> <span class="kw"><a href="../../reference/get_ids.html">get_ids</a></span>(species, <span class="st">"itis"</span>),</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">         <span class="dt">ncbi =</span> <span class="kw"><a href="../../reference/get_ids.html">get_ids</a></span>(species, <span class="st">"ncbi"</span>),</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">         <span class="dt">col =</span> <span class="kw"><a href="../../reference/get_ids.html">get_ids</a></span>(species, <span class="st">"col"</span>),</a>
<a class="sourceLine" id="cb8-5" data-line-number="5">         <span class="dt">gbif =</span> <span class="kw"><a href="../../reference/get_ids.html">get_ids</a></span>(species, <span class="st">"gbif"</span>),</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">         <span class="dt">wd =</span> <span class="kw"><a href="../../reference/get_ids.html">get_ids</a></span>(species, <span class="st">"wd"</span>),</a>
<a class="sourceLine" id="cb8-7" data-line-number="7">         <span class="dt">tpl =</span> <span class="kw"><a href="../../reference/get_ids.html">get_ids</a></span>(species, <span class="st">"tpl"</span>),</a>
<a class="sourceLine" id="cb8-8" data-line-number="8">         <span class="dt">fb =</span> <span class="kw"><a href="../../reference/get_ids.html">get_ids</a></span>(species, <span class="st">"fb"</span>),</a>
<a class="sourceLine" id="cb8-9" data-line-number="9">         <span class="dt">slb =</span> <span class="kw"><a href="../../reference/get_ids.html">get_ids</a></span>(species, <span class="st">"slb"</span>)) </a>
<a class="sourceLine" id="cb8-10" data-line-number="10">my_taxa</a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="co">#&gt; # A tibble: 233 x 9</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="co">#&gt;    species            itis    ncbi  col    gbif   wd      tpl   fb    slb  </span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="co">#&gt;    &lt;chr&gt;              &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;</span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="co">#&gt;  1 Allenopithecus ni… 944041  9472  21940… 24363… Q15978… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15"><span class="co">#&gt;  2 Allocebus trichot… 944072  9542  21940… 24363… Q35158… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb8-16" data-line-number="16"><span class="co">#&gt;  3 Alouatta belzebul  944100  9557  21940… 24363… Q10647… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb8-17" data-line-number="17"><span class="co">#&gt;  4 Alouatta caraya    1025177 9579  21940… 24364… Q41267… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb8-18" data-line-number="18"><span class="co">#&gt;  5 Alouatta coibensis 945103  9593  21941… 24364… Q21970… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb8-19" data-line-number="19"><span class="co">#&gt;  6 Alouatta fusca     944117  9600  21941… 24364… Q22113… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb8-20" data-line-number="20"><span class="co">#&gt;  7 Alouatta palliata  944115  13515 21940… 24364… Q21963… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb8-21" data-line-number="21"><span class="co">#&gt;  8 Alouatta pigra     945107  30602 21940… 24364… Q21948… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb8-22" data-line-number="22"><span class="co">#&gt;  9 Alouatta sara      944125  2224… 21940… 24364… Q21948… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb8-23" data-line-number="23"><span class="co">#&gt; 10 Alouatta seniculus 944138  9598  21940… 24364… Q713841 &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb8-24" data-line-number="24"><span class="co">#&gt; # ... with 223 more rows</span></a></code></pre></div>
<p>Can any single authority resolve all species names?</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">my_taxa <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>species) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="st">  </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span>(<span class="cf">function</span>(x) <span class="kw">sum</span>(<span class="op">!</span><span class="kw">is.na</span>(x)))</a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="co">#&gt; itis ncbi  col gbif   wd  tpl   fb  slb </span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="co">#&gt;  230   90  219   92  209    0    0    0</span></a></code></pre></div>
<p>Looks like <code>itis</code> has the most matches with 230. (Of course taxon-specific authorities like The Plant List, FishBase, and SeaLifeBase contain no primates).</p>
<p>We can also ask: do any species have no match in any authority?</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">has_match &lt;-<span class="st"> </span>my_taxa <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>species) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="st">  </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfc</a></span>(<span class="cf">function</span>(x) <span class="op">!</span><span class="kw">is.na</span>(x)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="st">  </span><span class="kw">rowSums</span>() <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"></a>
<a class="sourceLine" id="cb10-6" data-line-number="6">my_taxa <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="op">!</span>has_match)</a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co">#&gt; # A tibble: 1 x 9</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="co">#&gt;   species           itis  ncbi  col   gbif  wd    tpl   fb    slb  </span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co">#&gt;   &lt;chr&gt;             &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="co">#&gt; 1 Varecia variegata &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;</span></a></code></pre></div>
<p>One species still fails to resolve under any authority. A web search does resolve this as a misspelling, to <code>Leontopithecus chrysomelas</code>, but not one that is recongized automatically by the ITIS known synonyms.</p>
</div>
<div id="hierarchy" class="section level2">
<h2 class="hasAnchor">
<a href="#hierarchy" class="anchor"></a>Hierarchy</h2>
<p>Once we have resolved our ids, we can also get full classification information. This example uses the default authority, ITIS:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">primate_ids &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/get_ids.html">get_ids</a></span>(primates<span class="op">$</span>species, <span class="dt">format =</span> <span class="st">"prefix"</span>)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="kw"><a href="../../reference/classification.html">classification</a></span>(<span class="dt">id =</span> primate_ids)</a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="co">#&gt; Joining, by = "id"</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="co">#&gt; # A tibble: 233 x 26</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="co">#&gt;    id    class family genus infraclass infrakingdom infraorder infraphylum</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;        &lt;chr&gt;      &lt;chr&gt;      </span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="co">#&gt;  1 ITIS… Mamm… Homin… Homo  Eutheria   Deuterostom… Simiiform… Gnathostom…</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="co">#&gt;  2 ITIS… Mamm… Cebid… Saim… Eutheria   Deuterostom… Simiiform… Gnathostom…</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="co">#&gt;  3 ITIS… Mamm… Cerco… Maca… Eutheria   Deuterostom… Simiiform… Gnathostom…</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="co">#&gt;  4 ITIS… Mamm… Cerco… Maca… Eutheria   Deuterostom… Simiiform… Gnathostom…</span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="co">#&gt;  5 ITIS… Mamm… Cerco… Chlo… Eutheria   Deuterostom… Simiiform… Gnathostom…</span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="co">#&gt;  6 ITIS… Mamm… Cerco… Maca… Eutheria   Deuterostom… Simiiform… Gnathostom…</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="co">#&gt;  7 ITIS… Mamm… Cheir… Allo… Eutheria   Deuterostom… Lemurifor… Gnathostom…</span></a>
<a class="sourceLine" id="cb11-14" data-line-number="14"><span class="co">#&gt;  8 ITIS… Mamm… Cheir… Chei… Eutheria   Deuterostom… Lemurifor… Gnathostom…</span></a>
<a class="sourceLine" id="cb11-15" data-line-number="15"><span class="co">#&gt;  9 ITIS… Mamm… Cheir… Chei… Eutheria   Deuterostom… Lemurifor… Gnathostom…</span></a>
<a class="sourceLine" id="cb11-16" data-line-number="16"><span class="co">#&gt; 10 ITIS… Mamm… Cheir… Micr… Eutheria   Deuterostom… Lemurifor… Gnathostom…</span></a>
<a class="sourceLine" id="cb11-17" data-line-number="17"><span class="co">#&gt; # ... with 223 more rows, and 18 more variables: kingdom &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb11-18" data-line-number="18"><span class="co">#&gt; #   order &lt;chr&gt;, phylum &lt;chr&gt;, section &lt;chr&gt;, species &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb11-19" data-line-number="19"><span class="co">#&gt; #   subclass &lt;chr&gt;, subfamily &lt;chr&gt;, subgenus &lt;chr&gt;, subkingdom &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb11-20" data-line-number="20"><span class="co">#&gt; #   suborder &lt;chr&gt;, subphylum &lt;chr&gt;, subsection &lt;chr&gt;, subtribe &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb11-21" data-line-number="21"><span class="co">#&gt; #   superclass &lt;chr&gt;, superfamily &lt;chr&gt;, superorder &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb11-22" data-line-number="22"><span class="co">#&gt; #   superphylum &lt;chr&gt;, tribe &lt;chr&gt;</span></a></code></pre></div>
<p>the <code>classification</code> function can work on species names directly, but this will not resolve syonyms to identifiers first. As a result, only the 180 already recognized species names can be resolved in this case:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw"><a href="../../reference/classification.html">classification</a></span>(<span class="dt">species =</span> primates<span class="op">$</span>species)</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="co">#&gt; Joining, by = "species"</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="co">#&gt; # A tibble: 233 x 26</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="co">#&gt;    id    class family genus infraclass infrakingdom infraorder infraphylum</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;        &lt;chr&gt;      &lt;chr&gt;      </span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="co">#&gt;  1 ITIS… Mamm… Homin… Homo  Eutheria   Deuterostom… Simiiform… Gnathostom…</span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="co">#&gt;  2 ITIS… Mamm… Cebid… Saim… Eutheria   Deuterostom… Simiiform… Gnathostom…</span></a>
<a class="sourceLine" id="cb12-8" data-line-number="8"><span class="co">#&gt;  3 ITIS… Mamm… Cerco… Maca… Eutheria   Deuterostom… Simiiform… Gnathostom…</span></a>
<a class="sourceLine" id="cb12-9" data-line-number="9"><span class="co">#&gt;  4 ITIS… Mamm… Cerco… Maca… Eutheria   Deuterostom… Simiiform… Gnathostom…</span></a>
<a class="sourceLine" id="cb12-10" data-line-number="10"><span class="co">#&gt;  5 ITIS… Mamm… Cerco… Chlo… Eutheria   Deuterostom… Simiiform… Gnathostom…</span></a>
<a class="sourceLine" id="cb12-11" data-line-number="11"><span class="co">#&gt;  6 ITIS… Mamm… Cerco… Maca… Eutheria   Deuterostom… Simiiform… Gnathostom…</span></a>
<a class="sourceLine" id="cb12-12" data-line-number="12"><span class="co">#&gt;  7 ITIS… Mamm… Cheir… Allo… Eutheria   Deuterostom… Lemurifor… Gnathostom…</span></a>
<a class="sourceLine" id="cb12-13" data-line-number="13"><span class="co">#&gt;  8 ITIS… Mamm… Cheir… Chei… Eutheria   Deuterostom… Lemurifor… Gnathostom…</span></a>
<a class="sourceLine" id="cb12-14" data-line-number="14"><span class="co">#&gt;  9 ITIS… Mamm… Cheir… Chei… Eutheria   Deuterostom… Lemurifor… Gnathostom…</span></a>
<a class="sourceLine" id="cb12-15" data-line-number="15"><span class="co">#&gt; 10 ITIS… Mamm… Cheir… Micr… Eutheria   Deuterostom… Lemurifor… Gnathostom…</span></a>
<a class="sourceLine" id="cb12-16" data-line-number="16"><span class="co">#&gt; # ... with 223 more rows, and 18 more variables: kingdom &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb12-17" data-line-number="17"><span class="co">#&gt; #   order &lt;chr&gt;, phylum &lt;chr&gt;, section &lt;chr&gt;, species &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb12-18" data-line-number="18"><span class="co">#&gt; #   subclass &lt;chr&gt;, subfamily &lt;chr&gt;, subgenus &lt;chr&gt;, subkingdom &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb12-19" data-line-number="19"><span class="co">#&gt; #   suborder &lt;chr&gt;, subphylum &lt;chr&gt;, subsection &lt;chr&gt;, subtribe &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb12-20" data-line-number="20"><span class="co">#&gt; #   superclass &lt;chr&gt;, superfamily &lt;chr&gt;, superorder &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb12-21" data-line-number="21"><span class="co">#&gt; #   superphylum &lt;chr&gt;, tribe &lt;chr&gt;</span></a></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#introduction-the-problem-of-name-matching">Introduction: the problem of name matching</a><ul class="nav nav-pills nav-stacked">
<li><a href="#setup">Setup</a></li>
      <li><a href="#resolving-names">Resolving names</a></li>
      <li><a href="#hierarchy">Hierarchy</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Carl Boettiger, Kari Norman.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
